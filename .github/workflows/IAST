name: Snyk Security Scan
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  snyk-scan:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout do código
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Configura o .NET 8
      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      # 3. Instala o Snyk CLI
      - name: Install Snyk
        uses: snyk/actions/setup@master
        with:
          snyk-token: ${{ secrets.SNYK_TOKEN }}

      # 4. Executa o Snyk para testar dependências (SCA)
      - name: Run Snyk (Dependency Scan)
        run: snyk test --file=LibraryOnlineRentalSystem/src/API/project.csproj

      # 5. Executa o Snyk para análise de código (SAST) - Requer Snyk Code
      - name: Run Snyk Code (SAST)
        run: snyk code test --severity-threshold=high
